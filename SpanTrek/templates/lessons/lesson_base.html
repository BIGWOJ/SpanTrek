{% extends 'base/base.html' %} 
{% load static %}
{% block content %}

<link
    rel="stylesheet"
    type="text/css"
    href="{% static 'styles/lessons/lesson_base.css' %}"
/>

<div class="lesson-container">
    <div class="lesson-header">
        <!-- Navigation Buttons -->
        <div class="lesson-navigation">
            {% include 'lessons/back_to_country_map.html' with country=country %} 
            {% if prev_lesson_number %}
            <a
            href="{% url 'lessons:landmark_lesson_with_number' country=country landmark=landmark lesson_number=prev_lesson_number %}"
            class="nav-button prev-lesson"
            >
            <span class="arrow">←</span> Previous Lesson
        </a>
        {% endif %} 
    </div>
    
        <!-- Progress Bar -->
        {% include 'lessons/progress_bar.html' with progress_bar_progress=exercise_number progress_bar_max=total_exercises progress_bar_optional_text=" " %}

        <div class="lesson-meta">
            <span class="lesson-details">{{ lesson.title }} &bull; {{ country|title }} &bull; {{ landmark|title }} &bull; lesson {{ lesson_number|add:1 }}</span>
        </div>

        <!-- Exercise Navigation -->
        {% if total_exercises %}
        <div class="exercise-navigation">
            {% if prev_exercise_number %}
            <a
                href="{% url 'lessons:landmark_lesson_with_exercise' country=country landmark=landmark lesson_number=lesson_number exercise_number=prev_exercise_number %}"
                class="nav-button prev-exercise"
            >
                <span class="arrow">←</span> Back
            </a>
            {% endif %}
                        
            {% if next_exercise_number %}
            <a
                href="{% url 'lessons:landmark_lesson_with_exercise' country=country landmark=landmark lesson_number=lesson_number exercise_number=next_exercise_number %}"
                class="nav-button next-exercise"
                id="next-exercise-btn"
                {% if current_block == "fill_blank" or current_block == "input_field" or current_block == "translate_input_field" or current_block == "match" or current_block == "single_choice" or current_block == "multiple_choice" %}
                style="display: none;"
                {% endif %}
            >
                Next<span class="arrow">→</span>
            </a>
            {% elif next_lesson_number %}
            <a
                href="{% url 'lessons:lesson_complete' country=country landmark=landmark lesson_number=lesson_number %}"
                class="nav-button next-lesson"
                id="complete-lesson-btn"
                {% if current_block == "fill_blank" or current_block == "input_field" or current_block == "translate_input_field" or current_block == "match" or current_block == "single_choice" or current_block == "multiple_choice" %}
                style="display: none;"
                {% endif %}
            >
                Complete lesson <span class="arrow">→</span>
            </a>
            {% endif %}
        </div>
        {% endif %}

        <!-- Main Exercise Content -->
        <div class="lesson-content">
            {% if current_block and current_content %}
            <div class="single-content">
                {% if current_block == "audio" %}
                    {% include 'lessons/content/audio.html' with content=current_content %}
                {% elif current_block == "image" %}
                    {% include 'lessons/content/image.html' with content=current_content %}
                {% elif current_block == "text" %}
                    {% include 'lessons/content/text.html' with content=current_content %}
                {% elif current_block == "input_field" %}
                    {% include 'lessons/exercises/input_field.html' with content=current_content %}
                {% elif current_block == "translate_input_field" %}
                    {% include 'lessons/exercises/translate_input_field.html' with content=current_content %}
                {% elif current_block == "fill_blank" %}
                    {% include 'lessons/exercises/fill_blank.html' with content=current_content %}
                {% elif current_block == "match" %}
                    {% include 'lessons/exercises/match.html' with content=current_content %}
                {% elif current_block == "single_choice" %}
                    {% include 'lessons/exercises/single_choice.html' with content=current_content %}
                {% elif current_block == "multiple_choice" %}
                    {% include 'lessons/exercises/multiple_choice.html' with content=current_content %}
                {% else %}
                    <!-- Unknown block type: {{ current_block }} -->
                    <div class="error-block">Unknown content type: {{ current_block }}</div>
                {% endif %}
            </div>
            {% elif error %}
            <div class="error-message">
                <h2>{{ error }}</h2>
            </div>
            {% else %}
            <div class="error-message">
                <h2>No exercise content available</h2>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
