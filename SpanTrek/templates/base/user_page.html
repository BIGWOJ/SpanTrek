{%extends 'base/base.html'%} {%load static%} {% block styles %} {{ block.super}}

<link
    rel="stylesheet"
    type="text/css"
    href="{% static 'styles/base/user_page.css' %}"
/>
<script>

    window.userActivityDays = {{ user_activity_days|safe }};
</script>
<script src="{% static 'scripts/base/user_page.js' %}"></script>
{% endblock styles %} {%block content%}
<div class="hero-section">
    <div class="hero-content">
        <div class="profile-header">
            <div class="avatar-section">
                <div class="avatar-circle">
                    <img src="{{ user.avatar.url }}" />
                </div>
                <div class="profile-info">
                    <h1 class="username">{{ user.username }}</h1>
                    <p class="join-date">
                        Member since {{ user.date_joined|date:"d M Y" }}
                    </p>
                </div>
            </div>

            <div class="level-section">
                <div class="level-badge">
                    <span class="level-number">{{ user.level }}</span>
                    <span class="level-name">{{ user_level_name }}</span>
                </div>
                <div class="xp-progress">
                    <span class="xp-text">{{ user.experience }} XP</span>
                    <div class="progress-bar">
                        <div
                            class="progress-fill"
                            style="width: {{ progress_percentage }}%"
                        ></div>
                    </div>
                    <span class="next-level">
                        {{ xp_for_next_level }} XP to level {{ user.level|add:1 }}
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="main-content">
    <!-- Statistics Section -->
    <div class="stats-section">
        <h2 class="section-title">
            {% if request.user == user %}Your progress{% else %}User's
            progress{% endif %}
        </h2>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üéØ</div>
                <div class="stat-value">
                    {{ lessons_completed_percentage }}%
                </div>
                <div class="stat-label">Course Progress</div>
                <div class="stat-sublabel">
                    {{ completed_lessons }}/{{ total_lessons }}
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚ö°</div>
                <div class="stat-value">{{ user.days_streak }}</div>
                <div class="stat-label">Current streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üèÜ</div>
                <div class="stat-value">
                    {{ achievement_earned_percentage }}%
                </div>
                <div class="stat-label">Achievements</div>
                <div class="stat-sublabel">
                    {{ user.achievements.count }}/{{ total_achievements }}
                </div>
            </div>
            <div
                class="stat-card {% if lowest_knowledge_section == 'vocabulary' %}needs-improvement{% endif %}"
            >
                <div class="stat-icon">üìö</div>
                <div class="stat-value">{{ words_learned_percentage }}%</div>
                <div class="stat-label">Words learned</div>
                <div class="stat-sublabel">
                    {{ words_learned_count }}/{{ total_words_count }}
                </div>
                {% if lowest_knowledge_section == 'vocabulary' %}
                <div class="improvement-badge">
                    <span class="improve-text">üí™ Strengthen This</span>
                </div>
                {% endif %}
            </div>
            <div
                class="stat-card {% if lowest_knowledge_section == 'sentences' %}needs-improvement{% endif %}"
            >
                <div class="stat-icon">üí¨</div>
                <div class="stat-value">
                    {{ sentences_learned_percentage }}%
                </div>
                <div class="stat-label">Sentences</div>
                <div class="stat-sublabel">
                    {{ sentences_learned_count }}/{{ total_sentences_count }}
                </div>
                {% if lowest_knowledge_section == 'sentences' %}
                <div class="improvement-badge">
                    <span class="improve-text">üí™ Strengthen This</span>
                </div>
                {% endif %}
            </div>
            <div
                class="stat-card {% if lowest_knowledge_section == 'usage' %}needs-improvement{% endif %}"
            >
                <div class="stat-icon">üá™üá∏</div>
                <div class="stat-value">{{ use_of_spanish_percentage }}%</div>
                <div class="stat-label">Use of Spanish</div>
                <div class="stat-sublabel">
                    {{ user.use_of_spanish }}/{{ total_usage_count }}
                </div>
                {% if lowest_knowledge_section == 'usage' %}
                <div class="improvement-badge">
                    <span class="improve-text">üí™ Strengthen This</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Passports Section -->
    <div class="passports-section">
        <h2 class="section-title">Travel Passports</h2>
        <div class="passport-book">
            <div class="passport-spread">
                <div class="passport-page left-page">
                    <div class="passport-header">
                        <div class="passport-title">SPANISH LEARNING</div>
                        <div class="passport-subtitle">PASSPORT</div>
                        <div class="passport-emblem">üåç</div>
                    </div>

                    <div class="user-profile-section">
                        <div class="profile-photo-frame">
                            <img
                                src="{{ user.avatar.url }}"
                                alt="Profile Photo"
                                class="profile-photo"
                            />
                        </div>

                        <div class="user-details">
                            <div class="detail-row">
                                <span class="label">Name:</span>
                                <span class="value"
                                    >{{ user.username|upper }}</span
                                >
                            </div>
                            <div class="detail-row">
                                <span class="label">Border crossed:</span>
                                <span class="value"
                                    >{{ user.date_joined|date:"d M Y" }}</span
                                >
                            </div>
                            <div class="detail-row">
                                <span class="label">Level:</span>
                                <span class="value">{{ user.level }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Experience:</span>
                                <span class="value"
                                    >{{ user.experience }} XP</span
                                >
                            </div>
                            <div class="detail-row">
                                <span class="label">Highest streak:</span>
                                <span class="value"
                                    >{{ user.highest_streak }} days</span
                                >
                            </div>
                        </div>

                        <div class="passport-authority">
                            <div class="authority-stamp">
                                <div class="stamp-text">SPANTREK</div>
                                <div class="stamp-subtext">
                                    LANGUAGE AUTHORITY
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="passport-page right-page">
                    <div class="page-title">VISAS & STAMPS</div>

                    <div class="visa-stickers-grid">
                        <div
                            class="visa-sticker {% if 'poland' in user.passports_earned %}earned{% else %}locked{% endif %}"
                        >
                            <div class="sticker-flag">üáµüá±</div>
                            <div class="sticker-info">
                                <div class="country-code">POL</div>
                                <div class="country-name">POLAND</div>
                                <div class="sticker-status">
                                    {% if "poland" in user.passports_earned %}
                                    <span class="completed">‚úì COMPLETED</span>
                                    <span class="date"
                                        >{{ "now"|date:"d/m/Y" }}</span
                                    >
                                    {% else %}
                                    <span class="pending">LOCKED</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div
                            class="visa-sticker {% if 'spain' in user.passports_earned %}earned{% else %}locked{% endif %}"
                        >
                            <div class="sticker-flag">üá™üá∏</div>
                            <div class="sticker-info">
                                <div class="country-code">ESP</div>
                                <div class="country-name">SPAIN</div>
                                <div class="sticker-status">
                                    {% if "spain" in user.passports_earned %}
                                    <span class="completed">‚úì COMPLETED</span>
                                    <span class="date"
                                        >{{ "now"|date:"d/m/Y" }}</span
                                    >
                                    {% else %}
                                    <span class="pending">LOCKED</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div
                            class="visa-sticker {% if 'peru' in user.passports_earned %}earned{% else %}locked{% endif %}"
                        >
                            <div class="sticker-flag">üáµüá™</div>
                            <div class="sticker-info">
                                <div class="country-code">PER</div>
                                <div class="country-name">PERU</div>
                                <div class="sticker-status">
                                    {% if "peru" in user.passports_earned %}
                                    <span class="completed">‚úì COMPLETED</span>
                                    <span class="date"
                                        >{{ "now"|date:"d/m/Y" }}</span
                                    >
                                    {% else %}
                                    <span class="pending">LOCKED</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div
                            class="visa-sticker {% if 'mexico' in user.passports_earned %}earned{% else %}locked{% endif %}"
                        >
                            <div class="sticker-flag">üá≤üáΩ</div>
                            <div class="sticker-info">
                                <div class="country-code">MEX</div>
                                <div class="country-name">MEXICO</div>
                                <div class="sticker-status">
                                    {% if "mexico" in user.passports_earned %}
                                    <span class="completed">‚úì COMPLETED</span>
                                    <span class="date"
                                        >{{ "now"|date:"d/m/Y" }}</span
                                    >
                                    {% else %}
                                    <span class="pending">LOCKED</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="entry-stamps">
                        <div class="passport-stamp entry">
                            <div class="stamp-border">
                                <div class="stamp-authority">
                                    SPANTREK IMMIGRATION
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Achievements Section -->
    <div class="achievements-section">
        <h2 class="section-title">Achievements</h2>
        <div class="achievements-grid">
            {% for achievement in achievements %}
            <div
                class="achievement-card {% if achievement.earned %}earned{% else %}locked{% endif %}"
            >
                <div class="achievement-badge">
                    {{ achievement.achievement.icon }}
                </div>
                <div class="achievement-info">
                    <h4>{{ achievement.achievement.name }}</h4>
                    <p>{{ achievement.achievement.description }}</p>
                    <div class="achievement-reward">
                        <span class="xp-amount"
                            >{{ achievement.achievement.experience_award }}
                            XP</span
                        >
                    </div>
                </div>
                <div class="achievement-status">
                    {% if achievement.earned %}Earned{% else %}Locked{% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Activity Section -->
    <div class="activity-section">
        <h2 class="section-title">Recent Activity</h2>
        <div class="activity-calendar">
            <div class="calendar-header">
                <button class="nav-btn" id="prev-month">&larr;</button>
                <h3 id="current-month">August 2025</h3>
                <button class="nav-btn" id="next-month">&rarr;</button>
            </div>
            <div class="calendar-grid" id="calendar-grid">
                <!-- Calendar will be rendered by JavaScript -->
            </div>
        </div>
    </div>

    {% if request.user.id == user.id %}
    <!-- Settings Section -->
    <div class="settings-section">
        <h2 class="section-title">Account settings</h2>

        <div class="settings-collapsed" id="settings-collapsed">
            <button class="gear-btn" onclick="expandSettings()">‚öôÔ∏è</button>
        </div>

        <div
            class="settings-expanded"
            id="settings-expanded"
            style="display: none"
        >
            <div class="settings-grid">
                <div class="settings-card">
                    <div class="settings-header">
                        <h3>Profile information</h3>
                    </div>
                    <div class="settings-content" id="profile-content">
                        <div class="profile-edit">
                            <form
                                method="POST"
                                class="profile-form"
                                enctype="multipart/form-data"
                            >
                                {% csrf_token %}

                                <!-- Profile Picture Section -->
                                <div class="form-group profile-picture-section">
                                    <label>Profile picture:</label>
                                    <div class="avatar-upload-container">
                                        <div class="current-avatar">
                                            <img
                                                src="{{ user.avatar.url }}"
                                                alt="Current Avatar"
                                                id="avatar-preview"
                                            />
                                        </div>
                                        <div class="avatar-upload-controls">
                                            <input
                                                type="file"
                                                id="avatar-input"
                                                name="avatar"
                                                accept=".jpg,.jpeg,.png"
                                                class="file-input"
                                            />
                                            <label
                                                for="avatar-input"
                                                class="upload-btn"
                                            >
                                                üì∑ Choose new picture
                                            </label>
                                            <small class="upload-hint"
                                                >JPG, PNG up to 5MB
                                                <br />
                                                (drag & drop)</small
                                            >
                                        </div>
                                    </div>
                                </div>
                                <!-- Practice Settings -->
                                <div class="form-group practice-settings-group">
                                    <label class="section-label"
                                        >Practice settings</label
                                    >
                                    <div class="practice-settings-grid">
                                        <div class="practice-input-group">
                                            <label
                                                for="random-practice-count"
                                                class="practice-label"
                                            >
                                                <span class="practice-icon"
                                                    >üé≤</span
                                                >
                                                Random practice
                                            </label>
                                            <input
                                                type="number"
                                                id="random-practice-count"
                                                name="default_random_practice_count"
                                                value="{{ user.default_random_practice_count }}"
                                                min="5"
                                                max="50"
                                                class="profile-input practice-input"
                                            />
                                            <span class="input-suffix"
                                                >questions</span
                                            >
                                        </div>
                                        <div class="practice-input-group">
                                            <label
                                                for="vocabulary-practice-count"
                                                class="practice-label"
                                            >
                                                <span class="practice-icon"
                                                    >üìö</span
                                                >
                                                Vocabulary practice
                                            </label>
                                            <input
                                                type="number"
                                                id="vocabulary-practice-count"
                                                name="default_vocabulary_practice_count"
                                                value="{{ user.default_vocabulary_practice_count }}"
                                                min="5"
                                                max="50"
                                                class="profile-input practice-input"
                                            />
                                            <span class="input-suffix"
                                                >questions</span
                                            >
                                        </div>
                                        <div class="practice-input-group">
                                            <label
                                                for="sentence-practice-count"
                                                class="practice-label"
                                            >
                                                <span class="practice-icon"
                                                    >üí¨</span
                                                >
                                                Sentence practice
                                            </label>
                                            <input
                                                type="number"
                                                id="sentence-practice-count"
                                                name="default_sentence_practice_count"
                                                value="{{ user.default_sentence_practice_count }}"
                                                min="5"
                                                max="50"
                                                class="profile-input practice-input"
                                            />
                                            <span class="input-suffix"
                                                >questions</span
                                            >
                                        </div>
                                        <div class="practice-input-group">
                                            <label
                                                for="listening-practice-count"
                                                class="practice-label"
                                            >
                                                <span class="practice-icon"
                                                    >üéß</span
                                                >
                                                Listening practice
                                            </label>
                                            <input
                                                type="number"
                                                id="listening-practice-count"
                                                name="default_listening_practice_count"
                                                value="{{ user.default_listening_practice_count }}"
                                                min="5"
                                                max="50"
                                                class="profile-input practice-input"
                                            />
                                            <span class="input-suffix"
                                                >questions</span
                                            >
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="email-input">Email:</label>
                                    <input
                                        type="email"
                                        id="email-input"
                                        name="email"
                                        value="{{ user.email }}"
                                        class="profile-input"
                                    />
                                </div>
                                <div class="form-group">
                                    <label for="current-password"
                                        >Current password:</label
                                    >
                                    <input
                                        type="password"
                                        id="current-password"
                                        name="current_password"
                                        placeholder="Enter current password"
                                        class="profile-input"
                                    />
                                </div>
                                <div class="form-group">
                                    <label for="new-password"
                                        >New password:</label
                                    >
                                    <input
                                        type="password"
                                        id="new-password"
                                        name="new_password"
                                        placeholder="Enter new password"
                                        class="profile-input"
                                    />
                                </div>
                                <div class="form-group">
                                    <label for="confirm-password"
                                        >Confirm new password:</label
                                    >
                                    <input
                                        type="password"
                                        id="confirm-password"
                                        name="confirm_password"
                                        placeholder="Confirm new password"
                                        class="profile-input"
                                    />
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="save-btn">
                                        Save changes
                                    </button>
                                    <button
                                        type="button"
                                        class="cancel-btn"
                                        onclick="collapseSettings()"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Quick Actions -->
        <div class="quick-actions">
            <a href="{% url 'lessons:world_map' %}" class="action-btn primary">
                <span class="btn-icon">üè†</span>
                Continue learning
            </a>
            <a href="/logout" class="action-btn secondary">
                <span class="btn-icon">üö™</span>
                Logout
            </a>
        </div>
    </div>
    {%endblock content%}
</div>
